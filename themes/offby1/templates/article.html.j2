{% extends "base.html.j2" %}

{% block title %}{{ article.title }} - {{ SITENAME }}{% endblock %}
{% block description %}{{ (article.summary or article.content) | striptags | e | truncate(160) }}{% endblock %}

{% block og_title %}{{ article.title }}{% endblock %}
{% block og_description %}{{ (article.summary or article.content) | striptags | e | truncate(160) }}{% endblock %}
{% block og_url %}{{ SITEURL }}/{{ article.url }}{% endblock %}

{% block extra_head %}
{% if article.toot is defined %}
{# Load federated comments scripts #}
{% assets output="js/purify.js", "purify.min.js" %}
<script src="{{SITEURL}}/{{ASSET_URL}}"></script>
{% endassets %}
<script src="{{ SITEURL }}/js/federated-comments.js"></script>
{% endif %}
{% endblock %}

{% block body_class %}single-article{% endblock %}

{% block content %}
<article>
    <header>
        <h1>{{ article.title }}</h1>
        <div class="article-meta">
            <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
            {% if article.modified %}
            <span class="separator">·</span>
            <span>Updated: <time datetime="{{ article.modified.isoformat() }}">{{ article.modified.strftime('%B %d, %Y') }}</time></span>
            {% endif %}
            {% if article.category %}
            <span class="separator">·</span>
            <a href="{{ SITEURL }}/{{ article.category.url }}">{{ article.category }}</a>
            {% endif %}
            {% if article.author %}
            <span class="separator">·</span>
            <span>{{ article.author }}</span>
            {% endif %}
        </div>
    </header>
    
    <div class="article-content">
        {{ article.content }}
    </div>
    
    {% if article.photo_gallery %}
    <div class="photo-gallery">
        {% for title, gallery in article.photo_gallery %}
        <h2>{{ title }}</h2>
        <div class="gallery-grid">
            {% for name, photo, thumb, exif, caption in gallery %}
            <a href="{{ SITEURL }}/{{ photo }}" 
               class="gallery-item" 
               title="{{ name }}"
               {% if exif %}data-exif="{{ exif }}"{% endif %}
               {% if caption %}data-caption="{{ caption }}"{% endif %}>
                <img src="{{ SITEURL }}/{{ thumb }}" alt="{{ caption or name }}" loading="lazy">
                {% if caption %}
                <div class="gallery-caption">{{ caption }}</div>
                {% endif %}
            </a>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if article.tags %}
    <footer>
        <div class="article-tags">
            {% for tag in article.tags %}
            <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag }}</a>
            {% endfor %}
        </div>
    </footer>
    {% endif %}
    
    {# Feedback section #}
    <div class="article-feedback">
        {% if article.has_feedback %}
            <h3>Feedback</h3>
            {% if article.lobsters %}
                <p>Discuss this post on <a href="{{ article.lobsters }}">lobste.rs</a>.</p>
            {% endif %}
            {% if article.toot %}
                {% set toot = article.toot %}
                {% include "federated_comments.html.j2" %}
            {% endif %}
        {% else %}
            <div class="no-comments">
                <h3>Feedback</h3>
                <p>I don't embed any comments on this site, so if you want
                to give me feedback on the posts you find here, I encourage
                you tag me on <span class="fa-brands fa-mastodon"></span> <a class="sc-mastodon" href="https://wandering.shop/@offby1">wandering.shop</a></p>
            </div>
        {% endif %}
    </div>
</article>
{% endblock %}
